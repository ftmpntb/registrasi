<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Festival Teater Modern Pelajar se-NTB tahun 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 45px rgba(0, 0, 0, 0.1);
        }
        
        .input-modern {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
        }
        
        .input-modern:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(72, 187, 120, 0.3);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .theater-icon {
            font-size: 4rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-fadeInUp {
            animation: fadeInUp 0.6s ease-out;
        }
        
        .error-text {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        
        .success-text {
            color: #10b981;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body class="gradient-bg">
    <!-- Floating Header -->
    <header class="fixed top-0 left-0 right-0 z-40 bg-white/90 backdrop-blur-md shadow-lg">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col sm:flex-row items-center justify-center text-center">
                <div>
                    <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800">Festival Teater Modern Pelajar</h1>
                    <p class="text-sm sm:text-base text-gray-600">se-NTB tahun 2025</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-32 pb-20 px-4 sm:px-6 lg:px-8">
        <div class="container mx-auto max-w-6xl">
            
            <!-- Auth Section -->
            <div id="authSection" class="animate-fadeInUp">
                <div class="max-w-md mx-auto">
                    <div class="glass-card rounded-2xl p-6 sm:p-8">
                        <div class="text-center mb-8">
                            <h2 id="authTitle" class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">Masuk ke Akun</h2>
                            <p class="text-gray-600">Kelola pendaftaran festival teater</p>
                        </div>
                        
                        <!-- Login Form -->
                        <form id="loginForm" class="space-y-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Username</label>
                                <input type="text" id="loginUsername" class="w-full px-4 py-4 rounded-xl input-modern" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Password</label>
                                <input type="password" id="loginPassword" class="w-full px-4 py-4 rounded-xl input-modern" required>
                            </div>
                            <button type="submit" class="w-full btn-primary text-white py-4 rounded-xl font-semibold text-lg">
                                Masuk
                            </button>
                        </form>

                        <!-- Register Form -->
                        <form id="registerForm" class="space-y-6 hidden">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Username</label>
                                <input type="text" id="regUsername" class="w-full px-4 py-4 rounded-xl input-modern" 
                                       maxlength="7" pattern="[a-zA-Z0-9]+" required>
                                <div id="usernameError" class="error-text hidden">Username maksimal 7 karakter, hanya huruf dan angka</div>
                                <div id="usernameSuccess" class="success-text hidden">Username valid ‚úì</div>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Password</label>
                                <input type="password" id="regPassword" class="w-full px-4 py-4 rounded-xl input-modern" required>
                            </div>
                            <button type="submit" class="w-full btn-secondary text-white py-4 rounded-xl font-semibold text-lg">
                                Buat Akun
                            </button>
                        </form>

                        <div class="text-center mt-8">
                            <button id="toggleAuth" class="text-purple-600 hover:text-purple-800 font-semibold transition-colors">
                                Belum punya akun? Daftar di sini
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboardSection" class="hidden animate-fadeInUp">
                <div class="glass-card rounded-2xl p-6 sm:p-8 mb-8">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-8">
                        <div>
                            <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">Dashboard</h2>
                            <p id="welcomeUser" class="text-gray-600"></p>
                        </div>
                        <button id="logoutBtn" class="mt-4 sm:mt-0 bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl font-semibold transition-all hover:transform hover:-translate-y-1">
                            Keluar
                        </button>
                    </div>
                    
                    <!-- Payment Status Card -->
                    <div id="paymentStatusCard" class="glass-card rounded-2xl p-6 mb-6 border-l-4" style="border-left-color: #f59e0b;">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="text-3xl">üí≥</div>
                                <div>
                                    <h3 class="text-lg font-bold text-gray-800">Status Pembayaran</h3>
                                    <p id="paymentStatusText" class="text-sm text-gray-600">Memuat status...</p>
                                </div>
                            </div>
                            <div id="paymentStatusBadge" class="px-4 py-2 rounded-full text-sm font-semibold">
                                Memuat...
                            </div>
                        </div>
                    </div>

                    <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <button id="schoolDataBtn" class="card-hover bg-gradient-to-br from-blue-500 to-blue-600 text-white p-8 rounded-2xl text-left group">
                            <div class="text-4xl mb-4">üìö</div>
                            <h3 class="text-xl font-bold mb-3">Data Sekolah</h3>
                            <p class="text-blue-100 group-hover:text-white transition-colors">Kelola informasi sekolah dan sanggar</p>
                        </button>
                        <button id="registrationBtn" class="card-hover bg-gradient-to-br from-green-500 to-green-600 text-white p-8 rounded-2xl text-left group">
                            <div class="text-4xl mb-4">üë•</div>
                            <h3 class="text-xl font-bold mb-3">Registrasi Peserta</h3>
                            <p class="text-green-100 group-hover:text-white transition-colors">Daftarkan peserta festival</p>
                        </button>
                        <button id="paymentBtn" class="card-hover bg-gradient-to-br from-orange-500 to-orange-600 text-white p-8 rounded-2xl text-left group">
                            <div class="text-4xl mb-4">üí∞</div>
                            <h3 class="text-xl font-bold mb-3">Selesaikan Pendaftaran</h3>
                            <p class="text-orange-100 group-hover:text-white transition-colors">Upload bukti pembayaran</p>
                        </button>
                        <button id="checkParticipantsBtn" class="card-hover bg-gradient-to-br from-purple-500 to-purple-600 text-white p-8 rounded-2xl text-left group">
                            <div class="text-4xl mb-4">üìã</div>
                            <h3 class="text-xl font-bold mb-3">Cek Peserta Terdaftar</h3>
                            <p class="text-purple-100 group-hover:text-white transition-colors">Lihat dan kelola peserta yang sudah terdaftar</p>
                        </button>
                    </div>
                </div>
            </div>

            <!-- School Data Form -->
            <div id="schoolDataSection" class="hidden animate-fadeInUp">
                <div class="glass-card rounded-2xl p-6 sm:p-8">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-8">
                        <div>
                            <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">üìö Data Sekolah</h2>
                            <p class="text-gray-600">Lengkapi informasi sekolah dan sanggar</p>
                        </div>
                        <button id="backToDashboard1" class="mt-4 sm:mt-0 bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl font-semibold transition-all hover:transform hover:-translate-y-1">
                            Kembali
                        </button>
                    </div>
                    
                    <form id="schoolForm" class="space-y-6">
                        <div class="grid sm:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Nama Sekolah</label>
                                <input type="text" id="schoolName" class="w-full px-4 py-4 rounded-xl input-modern" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Nama Sanggar</label>
                                <input type="text" id="sanggarName" class="w-full px-4 py-4 rounded-xl input-modern" required>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Unggah Naskah</label>
                            <input type="file" id="scriptFile" class="w-full px-4 py-4 rounded-xl input-modern" accept=".pdf,.doc,.docx" required>
                            <p class="text-sm text-gray-500 mt-2">üìÅ Format: PDF, DOC, DOCX | 
                                <a href="https://docs.google.com/document/d/17fUA1-8vSAoO4UuY87LsViasCWoEs8la/edit?usp=sharing&ouid=85008&rtpof=true&sd=true" 
                                   target="_blank" class="text-blue-600 hover:underline font-medium">üì• Unduh Contoh</a>
                            </p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Unggah Plot Lampu</label>
                            <input type="file" id="lightPlotFile" class="w-full px-4 py-4 rounded-xl input-modern" accept=".pdf,.jpg,.jpeg,.png" required>
                            <p class="text-sm text-gray-500 mt-2">üí° Format: PDF, JPG, PNG | 
                                <a href="https://drive.google.com/drive/folders/1-y_A2OWNYamNVl-ntztamXkzvRPtQyr7?usp=sharing" 
                                   target="_blank" class="text-blue-600 hover:underline font-medium">üì• Unduh Contoh</a>
                            </p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Unggah Poster Pertunjukan</label>
                            <input type="file" id="posterFile" class="w-full px-4 py-4 rounded-xl input-modern" accept=".jpg,.jpeg,.png,.pdf" required>
                            <p class="text-sm text-gray-500 mt-2">üé® Format: JPG, PNG, PDF | 
                                <a href="https://drive.google.com/file/d/1NqYdT8R6I9eSKp7Ag8SjWdLeoQsnX-0p/view?usp=drive_link" 
                                   target="_blank" class="text-blue-600 hover:underline font-medium">üì• Unduh Contoh</a>
                            </p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Unggah Artistik</label>
                            <input type="file" id="artisticFile" class="w-full px-4 py-4 rounded-xl input-modern" accept=".jpg,.jpeg,.png,.pdf" required>
                            <p class="text-sm text-gray-500 mt-2">üé® Format: JPG, PNG, PDF | 
                                <a href="https://drive.google.com/file/d/1OUf5Ql3Y-IAVXMKxDVNBTbUe2gBf8zjR/view?usp=drive_link" 
                                   target="_blank" class="text-blue-600 hover:underline font-medium">üì• Unduh Contoh</a>
                            </p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Unggah Sinopsis</label>
                            <input type="file" id="synopsisFile" class="w-full px-4 py-4 rounded-xl input-modern" accept=".pdf,.doc,.docx" required>
                            <p class="text-sm text-gray-500 mt-2">üìñ Format: PDF, DOC, DOCX</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Unggah Profil Sanggar</label>
                            <input type="file" id="profileFile" class="w-full px-4 py-4 rounded-xl input-modern" accept=".pdf,.doc,.docx" required>
                            <p class="text-sm text-gray-500 mt-2">üèõÔ∏è Format: PDF, DOC, DOCX</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Kontak Pembina</label>
                            <input type="tel" id="supervisorContact" class="w-full px-4 py-4 rounded-xl input-modern" 
                                   placeholder="Contoh: 08123456789" required>
                            <p class="text-sm text-gray-500 mt-2">üì± Nomor WhatsApp pembina yang bisa dihubungi</p>
                        </div>
                        
                        <!-- Upload Progress -->
                        <div id="uploadProgress" class="hidden">
                            <div class="bg-gray-200 rounded-full h-3 mb-4">
                                <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                            <p id="uploadStatus" class="text-center text-gray-600 text-sm">Mengunggah file...</p>
                        </div>
                        
                        <button type="submit" id="saveSchoolBtn" class="w-full btn-primary text-white py-4 rounded-xl font-semibold text-lg">
                            Simpan Data Sekolah
                        </button>
                    </form>
                </div>
            </div>

            <!-- Check Participants Section -->
            <div id="checkParticipantsSection" class="hidden animate-fadeInUp">
                <div class="glass-card rounded-2xl p-6 sm:p-8">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-8">
                        <div>
                            <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">üìã Peserta Terdaftar</h2>
                            <p class="text-gray-600">Kelola peserta yang sudah terdaftar</p>
                        </div>
                        <button id="backToDashboard3" class="mt-4 sm:mt-0 bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl font-semibold transition-all hover:transform hover:-translate-y-1">
                            Kembali
                        </button>
                    </div>
                    
                    <!-- Loading State -->
                    <div id="participantsLoading" class="text-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
                        <p class="text-gray-600">Memuat data peserta...</p>
                    </div>
                    
                    <!-- Empty State -->
                    <div id="participantsEmpty" class="hidden text-center py-12">
                        <div class="text-6xl mb-4">üë•</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Belum Ada Peserta</h3>
                        <p class="text-gray-600 mb-6">Belum ada peserta yang terdaftar untuk sekolah Anda</p>
                        <button onclick="showSection('registration')" class="btn-secondary text-white px-6 py-3 rounded-xl font-semibold">
                            Daftarkan Peserta Pertama
                        </button>
                    </div>
                    
                    <!-- Participants List -->
                    <div id="participantsList" class="hidden space-y-4">
                        <!-- Participants will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Edit Participant Modal -->
            <div id="editParticipantModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden">
                <div class="flex items-center justify-center min-h-screen p-4">
                    <div class="glass-card rounded-2xl p-6 sm:p-8 max-w-md w-full max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-gray-800">‚úèÔ∏è Edit Peserta</h3>
                            <button id="closeEditModal" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                        </div>
                        
                        <form id="editParticipantForm" class="space-y-4">
                            <input type="hidden" id="editParticipantId">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Peserta (sesuai ijazah)</label>
                                <input type="text" id="editParticipantName" class="w-full px-4 py-3 rounded-xl input-modern" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Sebagai</label>
                                <select id="editParticipantRole" class="w-full px-4 py-3 rounded-xl input-modern" required>
                                    <option value="">Pilih Peran</option>
                                    <option value="aktor utama">üé≠ Aktor Utama</option>
                                    <option value="aktor pembantu">üé≠ Aktor Pembantu</option>
                                    <option value="aktris utama">üé≠ Aktris Utama</option>
                                    <option value="aktris pembantu">üé≠ Aktris Pembantu</option>
                                    <option value="penata music">üéµ Penata Music</option>
                                    <option value="tim artistic">üé® Tim Artistic</option>
                                    <option value="sutradara">üé¨ Sutradara</option>
                                    <option value="pembina">üë®‚Äçüè´ Pembina</option>
                                    <option value="penata lampu">üí° Penata Lampu</option>
                                    <option value="pubdok">üì¢ Pubdok</option>
                                    <option value="stage manager">üé™ Stage Manager</option>
                                    <option value="pelatih">üèÉ‚Äç‚ôÇÔ∏è Pelatih</option>
                                </select>
                            </div>
                            <div id="editCharacterNameDiv" class="hidden">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Tokoh</label>
                                <input type="text" id="editCharacterName" class="w-full px-4 py-3 rounded-xl input-modern">
                            </div>
                            
                            <!-- Common Fields for Edit -->
                            <div id="editCommonFieldsDiv" class="hidden space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Jenis Kelamin</label>
                                    <select id="editGender" class="w-full px-4 py-3 rounded-xl input-modern" required>
                                        <option value="">Pilih Jenis Kelamin</option>
                                        <option value="Laki-laki">üë® Laki-laki</option>
                                        <option value="Perempuan">üë© Perempuan</option>
                                    </select>
                                </div>
                                
                                <div id="editStudentCardDiv">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Unggah Kartu Pelajar Baru (Opsional)</label>
                                    <input type="file" id="editStudentCardFile" class="w-full px-4 py-3 rounded-xl input-modern" accept=".jpg,.jpeg,.png,.pdf">
                                    <p class="text-sm text-gray-500 mt-1">üÜî Kosongkan jika tidak ingin mengubah kartu pelajar</p>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Unggah Foto 3x4 Baru (Opsional)</label>
                                    <input type="file" id="editPhotoFile" class="w-full px-4 py-3 rounded-xl input-modern" accept=".jpg,.jpeg,.png">
                                    <p class="text-sm text-gray-500 mt-1">üì∑ Kosongkan jika tidak ingin mengubah foto</p>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Penyakit Bawaan</label>
                                    <textarea id="editMedicalCondition" class="w-full px-4 py-3 rounded-xl input-modern" rows="3" placeholder="Tuliskan penyakit bawaan atau kondisi kesehatan khusus. Jika tidak ada, tulis 'Tidak ada'"></textarea>
                                </div>
                            </div>
                            

                            <div class="flex gap-3 pt-4">
                                <button type="button" id="cancelEdit" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-xl font-semibold">
                                    Batal
                                </button>
                                <button type="submit" class="flex-1 btn-primary text-white py-3 rounded-xl font-semibold">
                                    Simpan
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Payment Section -->
            <div id="paymentSection" class="hidden animate-fadeInUp">
                <div class="glass-card rounded-2xl p-6 sm:p-8">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-8">
                        <div>
                            <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">üí∞ Selesaikan Pendaftaran</h2>
                            <p class="text-gray-600">Upload bukti pembayaran untuk menyelesaikan pendaftaran</p>
                        </div>
                        <button id="backToDashboard4" class="mt-4 sm:mt-0 bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl font-semibold transition-all hover:transform hover:-translate-y-1">
                            Kembali
                        </button>
                    </div>
                    
                    <!-- Payment Information -->
                    <div class="bg-gradient-to-r from-orange-50 to-yellow-50 border border-orange-200 rounded-2xl p-6 mb-8">
                        <div class="flex items-start gap-4">
                            <div class="text-3xl">üè¶</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Informasi Pembayaran</h3>
                                <div class="space-y-3 text-gray-700">
                                    <div class="flex items-center gap-3">
                                        <span class="font-semibold text-orange-600">üí∞ Biaya:</span>
                                        <span class="text-lg font-bold">Rp. 350.000,00 (Tiga Ratus Lima Puluh Ribu Rupiah)</span>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <span class="font-semibold text-orange-600">üè¶ Bank:</span>
                                        <span>BRI</span>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <span class="font-semibold text-orange-600">üì± No. Rekening:</span>
                                        <span class="font-mono bg-white px-3 py-1 rounded border">[Nomor Rekening]</span>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <span class="font-semibold text-orange-600">üë§ Atas Nama:</span>
                                        <span>Teater Putih</span>
                                    </div>
                                </div>
                                
                                <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-xl">
                                    <div class="flex items-start gap-3">
                                        <div class="text-2xl">üìç</div>
                                        <div>
                                            <h4 class="font-semibold text-blue-800 mb-2">Pembayaran Langsung</h4>
                                            <p class="text-blue-700 text-sm">
                                                Pembayaran juga dapat dilakukan langsung ke Sekretariat UKMF Teater Putih di 
                                                <strong>Gedung Ormawa Lantai 2, Jalan Majapahit No. 62 FKIP Universitas Mataram</strong>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Payment Status Display -->
                    <div id="currentPaymentStatus" class="mb-8">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    
                    <!-- Payment Upload Form -->
                    <form id="paymentForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Upload Bukti Pembayaran</label>
                            <input type="file" id="paymentProofFile" class="w-full px-4 py-4 rounded-xl input-modern" accept=".jpg,.jpeg,.png,.pdf" required>
                            <p class="text-sm text-gray-500 mt-2">üìÑ Format: JPG, PNG, PDF | Foto struk transfer atau bukti pembayaran</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Catatan Tambahan (Opsional)</label>
                            <textarea id="paymentNotes" class="w-full px-4 py-4 rounded-xl input-modern" rows="3" placeholder="Tambahkan catatan jika diperlukan, misalnya metode pembayaran atau informasi lainnya"></textarea>
                        </div>
                        
                        <button type="submit" id="submitPaymentBtn" class="w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white py-4 rounded-xl font-semibold text-lg transition-all hover:transform hover:-translate-y-1">
                            Upload Bukti Pembayaran
                        </button>
                    </form>
                </div>
            </div>

            <!-- Registration Form -->
            <div id="registrationSection" class="hidden animate-fadeInUp">
                <div class="glass-card rounded-2xl p-6 sm:p-8">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-8">
                        <div>
                            <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">üë• Registrasi Peserta</h2>
                            <p class="text-gray-600">Daftarkan peserta untuk festival teater</p>
                        </div>
                        <button id="backToDashboard2" class="mt-4 sm:mt-0 bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl font-semibold transition-all hover:transform hover:-translate-y-1">
                            Kembali
                        </button>
                    </div>
                    
                    <form id="participantForm" class="space-y-6">
                        <div class="grid sm:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Nama Peserta (sesuai ijazah)</label>
                                <input type="text" id="participantName" class="w-full px-4 py-4 rounded-xl input-modern" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Nama Sekolah</label>
                                <input type="text" id="participantSchool" class="w-full px-4 py-4 rounded-xl bg-gray-100 text-gray-600" readonly>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Sebagai</label>
                            <select id="participantRole" class="w-full px-4 py-4 rounded-xl input-modern" required>
                                <option value="">Pilih Peran</option>
                                <option value="aktor utama">üé≠ Aktor Utama</option>
                                <option value="aktor pembantu">üé≠ Aktor Pembantu</option>
                                <option value="aktris utama">üé≠ Aktris Utama</option>
                                <option value="aktris pembantu">üé≠ Aktris Pembantu</option>
                                <option value="penata music">üéµ Penata Music</option>
                                <option value="tim artistic">üé® Tim Artistic</option>
                                <option value="sutradara">üé¨ Sutradara</option>
                                <option value="pembina">üë®‚Äçüè´ Pembina</option>
                                <option value="penata lampu">üí° Penata Lampu</option>
                                <option value="pubdok">üì¢ Pubdok</option>
                                <option value="stage manager">üé™ Stage Manager</option>
                                <option value="pelatih">üèÉ‚Äç‚ôÇÔ∏è Pelatih</option>
                            </select>
                        </div>
                        
                        <!-- Fields for Pemain -->
                        <div id="characterNameDiv" class="hidden">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Nama Tokoh</label>
                            <input type="text" id="characterName" class="w-full px-4 py-4 rounded-xl input-modern">
                            <p class="text-sm text-gray-500 mt-2">üé≠ Nama karakter yang akan diperankan</p>
                        </div>
                        
                        <!-- Common Fields -->
                        <div id="commonFieldsDiv" class="hidden space-y-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Jenis Kelamin</label>
                                <select id="gender" class="w-full px-4 py-4 rounded-xl input-modern" required>
                                    <option value="">Pilih Jenis Kelamin</option>
                                    <option value="Laki-laki">üë® Laki-laki</option>
                                    <option value="Perempuan">üë© Perempuan</option>
                                </select>
                            </div>
                            
                            <div id="studentCardDiv">
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Unggah Kartu Pelajar</label>
                                <input type="file" id="studentCardFile" class="w-full px-4 py-4 rounded-xl input-modern" accept=".jpg,.jpeg,.png,.pdf" required>
                                <p class="text-sm text-gray-500 mt-2">üÜî Format: JPG, PNG, PDF | Kartu pelajar yang masih berlaku</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Unggah Foto 3x4</label>
                                <input type="file" id="photoFile" class="w-full px-4 py-4 rounded-xl input-modern" accept=".jpg,.jpeg,.png" required>
                                <p class="text-sm text-gray-500 mt-2">üì∑ Format: JPG, PNG | Foto 3x4 terbaru</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Penyakit Bawaan</label>
                                <textarea id="medicalCondition" class="w-full px-4 py-4 rounded-xl input-modern" rows="3" placeholder="Tuliskan penyakit bawaan atau kondisi kesehatan khusus. Jika tidak ada, tulis 'Tidak ada'"></textarea>
                                <p class="text-sm text-gray-500 mt-2">üè• Informasi penting untuk keselamatan peserta</p>
                            </div>
                        </div>
                        

                        
                        <button type="submit" class="w-full btn-secondary text-white py-4 rounded-xl font-semibold text-lg">
                            Daftarkan Peserta
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900/90 backdrop-blur-md text-white py-8">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h3 class="text-xl font-bold mb-2">Festival Teater Modern Pelajar se-NTB tahun 2025</h3>
        </div>
    </footer>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-24 right-4 transform translate-x-full transition-transform duration-300 z-50">
        <div class="glass-card rounded-xl p-4 max-w-sm">
            <div class="flex items-center">
                <div id="toastIcon" class="text-2xl mr-3"></div>
                <div>
                    <div id="toastMessage" class="font-semibold text-gray-800"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let schoolData = {};
        const API_URL = 'https://script.google.com/macros/s/AKfycbz2cN7ea4Mb7gNdpd0M4iS-at6drcMWnmt1d0Unlcu4oGWiI6immglM2qYc0_pYetMY/exec';

        // DOM elements
        const authSection = document.getElementById('authSection');
        const dashboardSection = document.getElementById('dashboardSection');
        const schoolDataSection = document.getElementById('schoolDataSection');
        const registrationSection = document.getElementById('registrationSection');
        const checkParticipantsSection = document.getElementById('checkParticipantsSection');
        const paymentSection = document.getElementById('paymentSection');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const authTitle = document.getElementById('authTitle');
        const toggleAuth = document.getElementById('toggleAuth');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            setupEventListeners();
        });

        // Make functions globally accessible for onclick handlers
        window.editParticipant = editParticipant;
        window.deleteParticipant = deleteParticipant;

        function setupEventListeners() {
            // Auth toggle
            toggleAuth.addEventListener('click', toggleAuthMode);
            
            // Username validation
            document.getElementById('regUsername').addEventListener('input', validateUsername);
            
            // Forms
            loginForm.addEventListener('submit', handleLogin);
            registerForm.addEventListener('submit', handleRegister);
            document.getElementById('schoolForm').addEventListener('submit', handleSchoolData);
            document.getElementById('participantForm').addEventListener('submit', handleParticipantRegistration);
            document.getElementById('paymentForm').addEventListener('submit', handlePaymentSubmission);
            
            // Navigation
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            document.getElementById('schoolDataBtn').addEventListener('click', () => showSection('schoolData'));
            document.getElementById('registrationBtn').addEventListener('click', () => showSection('registration'));
            document.getElementById('paymentBtn').addEventListener('click', () => showSection('payment'));
            document.getElementById('checkParticipantsBtn').addEventListener('click', () => showSection('checkParticipants'));
            document.getElementById('backToDashboard1').addEventListener('click', () => showSection('dashboard'));
            document.getElementById('backToDashboard2').addEventListener('click', () => showSection('dashboard'));
            document.getElementById('backToDashboard3').addEventListener('click', () => showSection('dashboard'));
            document.getElementById('backToDashboard4').addEventListener('click', () => showSection('dashboard'));
            
            // Role selection
            document.getElementById('participantRole').addEventListener('change', handleRoleChange);
            document.getElementById('editParticipantRole').addEventListener('change', handleEditRoleChange);
            
            // Modal controls
            document.getElementById('closeEditModal').addEventListener('click', closeEditModal);
            document.getElementById('cancelEdit').addEventListener('click', closeEditModal);
            document.getElementById('editParticipantForm').addEventListener('submit', handleEditParticipant);
        }

        function validateUsername() {
            const username = document.getElementById('regUsername').value;
            const errorDiv = document.getElementById('usernameError');
            const successDiv = document.getElementById('usernameSuccess');
            const regex = /^[a-zA-Z0-9]+$/;
            
            if (username.length > 7 || !regex.test(username)) {
                errorDiv.classList.remove('hidden');
                successDiv.classList.add('hidden');
                return false;
            } else if (username.length > 0) {
                errorDiv.classList.add('hidden');
                successDiv.classList.remove('hidden');
                return true;
            } else {
                errorDiv.classList.add('hidden');
                successDiv.classList.add('hidden');
                return false;
            }
        }

        function toggleAuthMode() {
            const isLogin = !loginForm.classList.contains('hidden');
            
            if (isLogin) {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
                authTitle.textContent = 'Buat Akun Baru';
                toggleAuth.textContent = 'Sudah punya akun? Masuk di sini';
            } else {
                registerForm.classList.add('hidden');
                loginForm.classList.remove('hidden');
                authTitle.textContent = 'Masuk ke Akun';
                toggleAuth.textContent = 'Belum punya akun? Daftar di sini';
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'login',
                        username: username,
                        password: password
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentUser = username;
                    localStorage.setItem('currentUser', username);
                    localStorage.setItem('userPassword', password); // Simpan password untuk data sekolah
                    if (result.schoolData) {
                        schoolData = result.schoolData;
                    }
                    showSection('dashboard');
                    showToast('Login berhasil!', 'success');
                } else {
                    showToast(result.message || 'Login gagal!', 'error');
                }
            } catch (error) {
                showToast('Terjadi kesalahan saat login', 'error');
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const username = document.getElementById('regUsername').value;
            const password = document.getElementById('regPassword').value;
            
            if (!validateUsername()) {
                showToast('Username tidak valid!', 'error');
                return;
            }
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'register',
                        username: username,
                        password: password,
                        createSheet: true // Flag untuk membuat sheet baru
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('Akun berhasil dibuat! Silakan login.', 'success');
                    toggleAuthMode();
                    document.getElementById('regUsername').value = '';
                    document.getElementById('regPassword').value = '';
                    document.getElementById('usernameError').classList.add('hidden');
                    document.getElementById('usernameSuccess').classList.add('hidden');
                } else {
                    showToast(result.message || 'Registrasi gagal!', 'error');
                }
            } catch (error) {
                showToast('Terjadi kesalahan saat registrasi', 'error');
            }
        }

        async function handleSchoolData(e) {
            e.preventDefault();
            const schoolName = document.getElementById('schoolName').value;
            const saveBtn = document.getElementById('saveSchoolBtn');
            const uploadProgress = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('progressBar');
            const uploadStatus = document.getElementById('uploadStatus');
            
            // Get all files
            const files = {
                scriptFile: document.getElementById('scriptFile').files[0],
                lightPlotFile: document.getElementById('lightPlotFile').files[0],
                posterFile: document.getElementById('posterFile').files[0],
                artisticFile: document.getElementById('artisticFile').files[0],
                synopsisFile: document.getElementById('synopsisFile').files[0],
                profileFile: document.getElementById('profileFile').files[0]
            };
            
            // Validate files
            for (const [key, file] of Object.entries(files)) {
                if (!file) {
                    showToast(`Harap pilih file untuk ${key.replace('File', '')}`, 'error');
                    return;
                }
            }
            
            // Show progress and disable button
            saveBtn.disabled = true;
            saveBtn.textContent = 'Mengunggah...';
            uploadProgress.classList.remove('hidden');
            
            try {
                // Convert files to base64 and upload one by one
                const fileData = {};
                const fileNames = Object.keys(files);
                let uploadedCount = 0;
                
                for (const [key, file] of Object.entries(files)) {
                    uploadStatus.textContent = `Mengunggah ${key.replace('File', '')}...`;
                    
                    // Convert to base64
                    const base64 = await fileToBase64(file);
                    
                    // Upload file
                    const uploadResponse = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8'
                        },
                        body: JSON.stringify({
                            action: 'uploadFile',
                            username: currentUser,
                            folderName: schoolName,
                            fileName: `${key.replace('File', '')}_${file.name}`,
                            fileData: base64,
                            mimeType: file.type
                        })
                    });
                    
                    const uploadResult = await uploadResponse.json();
                    
                    if (uploadResult.success) {
                        fileData[key.replace('File', 'Link')] = uploadResult.fileUrl;
                        uploadedCount++;
                        
                        // Update progress
                        const progress = (uploadedCount / fileNames.length) * 80; // 80% for file uploads
                        progressBar.style.width = `${progress}%`;
                    } else {
                        throw new Error(`Gagal mengunggah ${key}: ${uploadResult.message}`);
                    }
                }
                
                // Save school data
                uploadStatus.textContent = 'Menyimpan data sekolah...';
                progressBar.style.width = '90%';
                
                const formData = {
                    action: 'saveSchoolData',
                    username: currentUser,
                    password: localStorage.getItem('userPassword') || '',
                    schoolName: schoolName,
                    sanggarName: document.getElementById('sanggarName').value,
                    supervisorContact: document.getElementById('supervisorContact').value,
                    saveToSharedSheet: true,
                    createDriveFolder: true,
                    folderName: schoolName,
                    ...fileData // Include all uploaded file URLs
                };
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    schoolData = formData;
                    progressBar.style.width = '100%';
                    uploadStatus.textContent = 'Selesai!';
                    
                    let message = 'Data sekolah dan file berhasil disimpan!';
                    if (result.folderUrl) {
                        message += ` Folder Google Drive "${schoolName}" telah dibuat.`;
                        schoolData.driveFolder = result.folderUrl;
                    }
                    
                    setTimeout(() => {
                        showToast(message, 'success');
                        uploadProgress.classList.add('hidden');
                        progressBar.style.width = '0%';
                    }, 1000);
                } else {
                    throw new Error(result.message || 'Gagal menyimpan data sekolah!');
                }
            } catch (error) {
                showToast(error.message || 'Terjadi kesalahan saat menyimpan data', 'error');
                uploadProgress.classList.add('hidden');
                progressBar.style.width = '0%';
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Simpan Data Sekolah';
            }
        }
        
        // Helper function to convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    // Remove the data:mime;base64, prefix
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = error => reject(error);
            });
        }

        async function handleParticipantRegistration(e) {
            e.preventDefault();
            const role = document.getElementById('participantRole').value;
            const characterName = document.getElementById('characterName').value;
            const participantName = document.getElementById('participantName').value;
            const schoolName = schoolData.schoolName || '';
            
            // Get files
            const studentCardFile = document.getElementById('studentCardFile').files[0];
            const photoFile = document.getElementById('photoFile').files[0];
            
            // Validate required files
            if (!photoFile) {
                showToast('Harap pilih foto 3x4!', 'error');
                return;
            }
            
            if ((role !== 'pembina' && role !== 'pelatih') && !studentCardFile) {
                showToast('Harap pilih kartu pelajar!', 'error');
                return;
            }
            
            try {
                // Show loading state
                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = 'Mengunggah file...';
                
                let studentCardLink = '';
                let photoLink = '';
                
                // Upload student card if required
                if (studentCardFile) {
                    const studentCardBase64 = await fileToBase64(studentCardFile);
                    const studentCardResponse = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8'
                        },
                        body: JSON.stringify({
                            action: 'uploadFile',
                            username: currentUser,
                            folderName: schoolName,
                            fileName: `${schoolName}_${participantName}_KartuPelajar.${studentCardFile.name.split('.').pop()}`,
                            fileData: studentCardBase64,
                            mimeType: studentCardFile.type
                        })
                    });
                    
                    const studentCardResult = await studentCardResponse.json();
                    if (!studentCardResult.success) {
                        throw new Error('Gagal mengunggah kartu pelajar');
                    }
                    studentCardLink = studentCardResult.fileUrl;
                }
                
                // Upload photo
                const photoBase64 = await fileToBase64(photoFile);
                const photoResponse = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'uploadFile',
                        username: currentUser,
                        folderName: schoolName,
                        fileName: `${schoolName}_${participantName}_Foto.${photoFile.name.split('.').pop()}`,
                        fileData: photoBase64,
                        mimeType: photoFile.type
                    })
                });
                
                const photoResult = await photoResponse.json();
                if (!photoResult.success) {
                    throw new Error('Gagal mengunggah foto');
                }
                photoLink = photoResult.fileUrl;
                
                // Register participant with file URLs
                submitBtn.textContent = 'Menyimpan data...';
                
                const formData = {
                    action: 'registerParticipant',
                    username: currentUser,
                    participantName: participantName,
                    schoolName: schoolName,
                    role: role,
                    characterName: (role === 'aktor utama' || role === 'aktor pembantu' || role === 'aktris utama' || role === 'aktris pembantu') ? characterName : '',
                    gender: document.getElementById('gender').value,
                    studentCardLink: studentCardLink,
                    photoLink: photoLink,
                    medicalCondition: document.getElementById('medicalCondition').value,
                    writeToUserSheet: true
                };
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('Peserta berhasil didaftarkan!', 'success');
                    document.getElementById('participantForm').reset();
                    document.getElementById('participantSchool').value = schoolName;
                    document.getElementById('characterNameDiv').classList.add('hidden');
                    document.getElementById('commonFieldsDiv').classList.add('hidden');
                } else {
                    showToast(result.message || 'Gagal mendaftarkan peserta!', 'error');
                }
                
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
                
            } catch (error) {
                showToast(error.message || 'Terjadi kesalahan saat mendaftarkan peserta', 'error');
                const submitBtn = e.target.querySelector('button[type="submit"]');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Daftarkan Peserta';
            }
        }

        function handleRoleChange() {
            const role = document.getElementById('participantRole').value;
            const characterNameDiv = document.getElementById('characterNameDiv');
            const commonFieldsDiv = document.getElementById('commonFieldsDiv');
            const studentCardDiv = document.getElementById('studentCardDiv');
            const studentCardInput = document.getElementById('studentCardLink');
            
            if (role) {
                // Show common fields for all roles
                commonFieldsDiv.classList.remove('hidden');
                
                if (role === 'aktor utama' || role === 'aktor pembantu' || role === 'aktris utama' || role === 'aktris pembantu') {
                    // Show character name for actor/actress roles
                    characterNameDiv.classList.remove('hidden');
                    document.getElementById('characterName').required = true;
                    
                    // Show student card for actor/actress roles
                    studentCardDiv.classList.remove('hidden');
                    document.getElementById('studentCardFile').required = true;
                } else {
                    // Hide character name for non-actor roles
                    characterNameDiv.classList.add('hidden');
                    document.getElementById('characterName').required = false;
                    document.getElementById('characterName').value = '';
                    
                    // Check if role needs student card
                    if (role === 'pembina' || role === 'pelatih') {
                        // Hide student card for pembina and pelatih
                        studentCardDiv.classList.add('hidden');
                        document.getElementById('studentCardFile').required = false;
                        document.getElementById('studentCardFile').value = '';
                    } else {
                        // Show student card for other roles
                        studentCardDiv.classList.remove('hidden');
                        document.getElementById('studentCardFile').required = true;
                    }
                }
            } else {
                // Hide all additional fields if no role selected
                characterNameDiv.classList.add('hidden');
                commonFieldsDiv.classList.add('hidden');
                document.getElementById('characterName').required = false;
                document.getElementById('studentCardFile').required = false;
            }
        }

        function showSection(section) {
            // Hide all sections
            authSection.classList.add('hidden');
            dashboardSection.classList.add('hidden');
            schoolDataSection.classList.add('hidden');
            registrationSection.classList.add('hidden');
            checkParticipantsSection.classList.add('hidden');
            paymentSection.classList.add('hidden');
            
            // Show selected section with animation
            setTimeout(() => {
                switch(section) {
                    case 'auth':
                        authSection.classList.remove('hidden');
                        break;
                    case 'dashboard':
                        dashboardSection.classList.remove('hidden');
                        document.getElementById('welcomeUser').textContent = `Selamat datang, ${currentUser}! üëã`;
                        loadPaymentStatus();
                        break;
                    case 'schoolData':
                        schoolDataSection.classList.remove('hidden');
                        loadSchoolData();
                        break;
                    case 'registration':
                        if (!schoolData.schoolName) {
                            showToast('Harap isi data sekolah terlebih dahulu!', 'error');
                            showSection('schoolData');
                            return;
                        }
                        registrationSection.classList.remove('hidden');
                        document.getElementById('participantSchool').value = schoolData.schoolName;
                        break;
                    case 'payment':
                        paymentSection.classList.remove('hidden');
                        loadCurrentPaymentStatus();
                        break;
                    case 'checkParticipants':
                        checkParticipantsSection.classList.remove('hidden');
                        loadParticipants();
                        break;
                }
            }, 100);
        }

        async function loadPaymentStatus() {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'getPaymentStatus',
                        username: currentUser
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    updatePaymentStatusDisplay(result.paymentStatus || 'belum_bayar');
                } else {
                    updatePaymentStatusDisplay('belum_bayar');
                }
            } catch (error) {
                updatePaymentStatusDisplay('belum_bayar');
            }
        }

        function updatePaymentStatusDisplay(status) {
            const statusCard = document.getElementById('paymentStatusCard');
            const statusText = document.getElementById('paymentStatusText');
            const statusBadge = document.getElementById('paymentStatusBadge');
            
            switch(status) {
                case 'lunas':
                    statusCard.style.borderLeftColor = '#10b981';
                    statusText.textContent = 'Pembayaran telah lunas dan terverifikasi';
                    statusBadge.textContent = 'LUNAS';
                    statusBadge.className = 'px-4 py-2 rounded-full text-sm font-semibold bg-green-100 text-green-800';
                    break;
                case 'pending':
                    statusCard.style.borderLeftColor = '#f59e0b';
                    statusText.textContent = 'Bukti pembayaran sedang diverifikasi';
                    statusBadge.textContent = 'PENDING';
                    statusBadge.className = 'px-4 py-2 rounded-full text-sm font-semibold bg-yellow-100 text-yellow-800';
                    break;
                case 'ditolak':
                    statusCard.style.borderLeftColor = '#ef4444';
                    statusText.textContent = 'Bukti pembayaran ditolak, silakan upload ulang';
                    statusBadge.textContent = 'DITOLAK';
                    statusBadge.className = 'px-4 py-2 rounded-full text-sm font-semibold bg-red-100 text-red-800';
                    break;
                default:
                    statusCard.style.borderLeftColor = '#6b7280';
                    statusText.textContent = 'Belum melakukan pembayaran';
                    statusBadge.textContent = 'BELUM BAYAR';
                    statusBadge.className = 'px-4 py-2 rounded-full text-sm font-semibold bg-gray-100 text-gray-800';
            }
        }

        async function loadCurrentPaymentStatus() {
            const currentStatusDiv = document.getElementById('currentPaymentStatus');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'getPaymentStatus',
                        username: currentUser
                    })
                });
                
                const result = await response.json();
                const status = result.success ? (result.paymentStatus || 'belum_bayar') : 'belum_bayar';
                
                let statusHTML = '';
                
                switch(status) {
                    case 'lunas':
                        statusHTML = `
                            <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                                <div class="flex items-center gap-4">
                                    <div class="text-3xl">‚úÖ</div>
                                    <div>
                                        <h3 class="text-lg font-bold text-green-800">Pembayaran Lunas</h3>
                                        <p class="text-green-700">Pembayaran Anda telah terverifikasi dan lunas. Pendaftaran selesai!</p>
                                    </div>
                                </div>
                            </div>
                        `;
                        document.getElementById('paymentForm').style.display = 'none';
                        break;
                    case 'pending':
                        statusHTML = `
                            <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6">
                                <div class="flex items-center gap-4">
                                    <div class="text-3xl">‚è≥</div>
                                    <div>
                                        <h3 class="text-lg font-bold text-yellow-800">Menunggu Verifikasi</h3>
                                        <p class="text-yellow-700">Bukti pembayaran Anda sedang diverifikasi. Mohon tunggu konfirmasi.</p>
                                        ${result.paymentProofLink ? `<p class="text-sm mt-2"><a href="${result.paymentProofLink}" target="_blank" class="text-blue-600 hover:underline">üìÑ Lihat bukti pembayaran yang diupload</a></p>` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                        document.getElementById('paymentForm').style.display = 'block';
                        document.getElementById('submitPaymentBtn').textContent = 'Upload Ulang Bukti Pembayaran';
                        break;
                    case 'ditolak':
                        statusHTML = `
                            <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                                <div class="flex items-center gap-4">
                                    <div class="text-3xl">‚ùå</div>
                                    <div>
                                        <h3 class="text-lg font-bold text-red-800">Bukti Pembayaran Ditolak</h3>
                                        <p class="text-red-700">Bukti pembayaran tidak valid. Silakan upload bukti pembayaran yang benar.</p>
                                        ${result.rejectionNote ? `<p class="text-sm mt-2 text-red-600"><strong>Catatan:</strong> ${result.rejectionNote}</p>` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                        document.getElementById('paymentForm').style.display = 'block';
                        document.getElementById('submitPaymentBtn').textContent = 'Upload Ulang Bukti Pembayaran';
                        break;
                    default:
                        statusHTML = `
                            <div class="bg-gray-50 border border-gray-200 rounded-xl p-6">
                                <div class="flex items-center gap-4">
                                    <div class="text-3xl">üí≥</div>
                                    <div>
                                        <h3 class="text-lg font-bold text-gray-800">Belum Melakukan Pembayaran</h3>
                                        <p class="text-gray-700">Silakan lakukan pembayaran dan upload bukti pembayaran untuk menyelesaikan pendaftaran.</p>
                                    </div>
                                </div>
                            </div>
                        `;
                        document.getElementById('paymentForm').style.display = 'block';
                        document.getElementById('submitPaymentBtn').textContent = 'Upload Bukti Pembayaran';
                }
                
                currentStatusDiv.innerHTML = statusHTML;
                
            } catch (error) {
                currentStatusDiv.innerHTML = `
                    <div class="bg-gray-50 border border-gray-200 rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="text-3xl">üí≥</div>
                            <div>
                                <h3 class="text-lg font-bold text-gray-800">Belum Melakukan Pembayaran</h3>
                                <p class="text-gray-700">Silakan lakukan pembayaran dan upload bukti pembayaran untuk menyelesaikan pendaftaran.</p>
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById('paymentForm').style.display = 'block';
            }
        }

        async function handlePaymentSubmission(e) {
            e.preventDefault();
            const paymentProofFile = document.getElementById('paymentProofFile').files[0];
            const paymentNotes = document.getElementById('paymentNotes').value;
            const schoolName = schoolData.schoolName || '';
            
            if (!paymentProofFile) {
                showToast('Harap pilih file bukti pembayaran!', 'error');
                return;
            }
            
            try {
                // Show loading state
                const submitBtn = document.getElementById('submitPaymentBtn');
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = 'Mengunggah bukti pembayaran...';
                
                // Upload payment proof file
                const paymentProofBase64 = await fileToBase64(paymentProofFile);
                const paymentProofResponse = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'uploadFile',
                        username: currentUser,
                        folderName: schoolName,
                        fileName: `${schoolName}_BuktiPembayaran.${paymentProofFile.name.split('.').pop()}`,
                        fileData: paymentProofBase64,
                        mimeType: paymentProofFile.type
                    })
                });
                
                const paymentProofResult = await paymentProofResponse.json();
                if (!paymentProofResult.success) {
                    throw new Error('Gagal mengunggah bukti pembayaran');
                }
                
                // Submit payment data
                submitBtn.textContent = 'Menyimpan data pembayaran...';
                
                const formData = {
                    action: 'submitPayment',
                    username: currentUser,
                    schoolName: schoolName,
                    paymentProofLink: paymentProofResult.fileUrl,
                    paymentNotes: paymentNotes,
                    paymentStatus: 'pending' // Default status
                };
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('Bukti pembayaran berhasil diupload! Status: Pending verifikasi', 'success');
                    document.getElementById('paymentForm').reset();
                    loadCurrentPaymentStatus(); // Reload status
                    loadPaymentStatus(); // Update dashboard status
                } else {
                    showToast(result.message || 'Gagal mengupload bukti pembayaran!', 'error');
                }
                
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
                
            } catch (error) {
                showToast(error.message || 'Terjadi kesalahan saat mengupload bukti pembayaran', 'error');
                const submitBtn = document.getElementById('submitPaymentBtn');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Upload Bukti Pembayaran';
            }
        }

        async function loadParticipants() {
            const loadingDiv = document.getElementById('participantsLoading');
            const emptyDiv = document.getElementById('participantsEmpty');
            const listDiv = document.getElementById('participantsList');
            
            // Show loading state
            loadingDiv.classList.remove('hidden');
            emptyDiv.classList.add('hidden');
            listDiv.classList.add('hidden');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'getParticipants',
                        username: currentUser
                    })
                });
                
                const result = await response.json();
                
                if (result.success && result.participants && result.participants.length > 0) {
                    displayParticipants(result.participants);
                    listDiv.classList.remove('hidden');
                } else {
                    emptyDiv.classList.remove('hidden');
                }
            } catch (error) {
                showToast('Gagal memuat data peserta', 'error');
                emptyDiv.classList.remove('hidden');
            } finally {
                loadingDiv.classList.add('hidden');
            }
        }

        function displayParticipants(participants) {
            const listDiv = document.getElementById('participantsList');
            listDiv.innerHTML = '';
            
            participants.forEach((participant, index) => {
                const participantCard = document.createElement('div');
                participantCard.className = 'glass-card rounded-xl p-6 card-hover';
                
                // Build additional info
                let additionalInfo = `<p>üè´ ${participant.schoolName}</p>`;
                if (participant.gender) {
                    additionalInfo += `<p>${participant.gender === 'Laki-laki' ? 'üë®' : 'üë©'} ${participant.gender}</p>`;
                }
                if (participant.studentCardLink && participant.role !== 'pembina' && participant.role !== 'pelatih') {
                    additionalInfo += `<p>üÜî <a href="${participant.studentCardLink}" target="_blank" class="text-blue-600 hover:underline">Lihat Kartu Pelajar</a></p>`;
                }
                if (participant.photoLink) {
                    additionalInfo += `<p>üì∑ <a href="${participant.photoLink}" target="_blank" class="text-blue-600 hover:underline">Lihat Foto 3x4</a></p>`;
                }
                if (participant.medicalCondition) {
                    additionalInfo += `<p>üè• ${participant.medicalCondition}</p>`;
                }

                
                participantCard.innerHTML = `
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="text-2xl">${getRoleIcon(participant.role)}</div>
                                <div>
                                    <h3 class="text-lg font-bold text-gray-800">${participant.participantName}</h3>
                                    <p class="text-sm text-gray-600">${participant.role}${participant.characterName ? ` - ${participant.characterName}` : ''}</p>
                                </div>
                            </div>
                            <div class="text-sm text-gray-500">
                                ${additionalInfo}
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editParticipant(${index})" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold transition-all hover:transform hover:-translate-y-1">
                                ‚úèÔ∏è Edit
                            </button>
                            <button onclick="deleteParticipant(${index})" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-semibold transition-all hover:transform hover:-translate-y-1">
                                üóëÔ∏è Hapus
                            </button>
                        </div>
                    </div>
                `;
                listDiv.appendChild(participantCard);
            });
        }

        function getRoleIcon(role) {
            const icons = {
                'aktor utama': 'üé≠',
                'aktor pembantu': 'üé≠',
                'aktris utama': 'üé≠',
                'aktris pembantu': 'üé≠',
                'penata music': 'üéµ',
                'tim artistic': 'üé®',
                'sutradara': 'üé¨',
                'pembina': 'üë®‚Äçüè´',
                'penata lampu': 'üí°',
                'pubdok': 'üì¢',
                'stage manager': 'üé™',
                'pelatih': 'üèÉ‚Äç‚ôÇÔ∏è'
            };
            return icons[role] || 'üë§';
        }

        let currentParticipants = [];

        async function editParticipant(index) {
            // Get current participants data
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'getParticipants',
                        username: currentUser
                    })
                });
                
                const result = await response.json();
                if (result.success && result.participants) {
                    currentParticipants = result.participants;
                    const participant = currentParticipants[index];
                    
                    // Fill edit form
                    document.getElementById('editParticipantId').value = index;
                    document.getElementById('editParticipantName').value = participant.participantName;
                    document.getElementById('editParticipantRole').value = participant.role;
                    document.getElementById('editCharacterName').value = participant.characterName || '';
                    document.getElementById('editGender').value = participant.gender || '';
                    document.getElementById('editMedicalCondition').value = participant.medicalCondition || '';
                    
                    // Clear file inputs (they can't be pre-filled)
                    document.getElementById('editStudentCardFile').value = '';
                    document.getElementById('editPhotoFile').value = '';

                    
                    // Handle field visibility based on role
                    handleEditRoleChange();
                    
                    // Show modal
                    document.getElementById('editParticipantModal').classList.remove('hidden');
                }
            } catch (error) {
                showToast('Gagal memuat data peserta', 'error');
            }
        }

        function handleEditRoleChange() {
            const role = document.getElementById('editParticipantRole').value;
            const characterNameDiv = document.getElementById('editCharacterNameDiv');
            const commonFieldsDiv = document.getElementById('editCommonFieldsDiv');
            const studentCardDiv = document.getElementById('editStudentCardDiv');
            const studentCardInput = document.getElementById('editStudentCardFile');
            
            if (role) {
                // Show common fields for all roles
                commonFieldsDiv.classList.remove('hidden');
                
                if (role === 'aktor utama' || role === 'aktor pembantu' || role === 'aktris utama' || role === 'aktris pembantu') {
                    // Show character name for actor/actress roles
                    characterNameDiv.classList.remove('hidden');
                    document.getElementById('editCharacterName').required = true;
                    
                    // Show student card for actor/actress roles
                    studentCardDiv.classList.remove('hidden');
                    document.getElementById('studentCardFile').required = true;
                } else {
                    // Hide character name for non-actor roles
                    characterNameDiv.classList.add('hidden');
                    document.getElementById('editCharacterName').required = false;
                    document.getElementById('editCharacterName').value = '';
                    
                    // Check if role needs student card
                    if (role === 'pembina' || role === 'pelatih') {
                        // Hide student card for pembina and pelatih
                        studentCardDiv.classList.add('hidden');
                        document.getElementById('studentCardFile').required = false;
                        document.getElementById('studentCardFile').value = '';
                    } else {
                        // Show student card for other roles
                        studentCardDiv.classList.remove('hidden');
                        document.getElementById('studentCardFile').required = true;
                    }
                }
            } else {
                // Hide all additional fields if no role selected
                characterNameDiv.classList.add('hidden');
                commonFieldsDiv.classList.add('hidden');
                document.getElementById('editCharacterName').required = false;
                studentCardInput.required = false;
            }
        }

        async function handleEditParticipant(e) {
            e.preventDefault();
            const index = parseInt(document.getElementById('editParticipantId').value);
            const role = document.getElementById('editParticipantRole').value;
            const participantName = document.getElementById('editParticipantName').value;
            const schoolName = schoolData.schoolName || '';
            
            // Get files (optional for edit)
            const studentCardFile = document.getElementById('editStudentCardFile').files[0];
            const photoFile = document.getElementById('editPhotoFile').files[0];
            
            try {
                // Show loading state
                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                
                let studentCardLink = '';
                let photoLink = '';
                
                // Upload new student card if provided
                if (studentCardFile) {
                    submitBtn.textContent = 'Mengunggah kartu pelajar...';
                    const studentCardBase64 = await fileToBase64(studentCardFile);
                    const studentCardResponse = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8'
                        },
                        body: JSON.stringify({
                            action: 'uploadFile',
                            username: currentUser,
                            folderName: schoolName,
                            fileName: `${schoolName}_${participantName}_KartuPelajar.${studentCardFile.name.split('.').pop()}`,
                            fileData: studentCardBase64,
                            mimeType: studentCardFile.type
                        })
                    });
                    
                    const studentCardResult = await studentCardResponse.json();
                    if (!studentCardResult.success) {
                        throw new Error('Gagal mengunggah kartu pelajar');
                    }
                    studentCardLink = studentCardResult.fileUrl;
                }
                
                // Upload new photo if provided
                if (photoFile) {
                    submitBtn.textContent = 'Mengunggah foto...';
                    const photoBase64 = await fileToBase64(photoFile);
                    const photoResponse = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8'
                        },
                        body: JSON.stringify({
                            action: 'uploadFile',
                            username: currentUser,
                            folderName: schoolName,
                            fileName: `${schoolName}_${participantName}_Foto.${photoFile.name.split('.').pop()}`,
                            fileData: photoBase64,
                            mimeType: photoFile.type
                        })
                    });
                    
                    const photoResult = await photoResponse.json();
                    if (!photoResult.success) {
                        throw new Error('Gagal mengunggah foto');
                    }
                    photoLink = photoResult.fileUrl;
                }
                
                // Update participant data
                submitBtn.textContent = 'Menyimpan data...';
                
                const formData = {
                    action: 'editParticipant',
                    username: currentUser,
                    participantIndex: index,
                    participantName: participantName,
                    role: role,
                    characterName: (role === 'aktor utama' || role === 'aktor pembantu' || role === 'aktris utama' || role === 'aktris pembantu') ? document.getElementById('editCharacterName').value : '',
                    gender: document.getElementById('editGender').value,
                    studentCardLink: studentCardLink, // Will be empty if no new file uploaded
                    photoLink: photoLink, // Will be empty if no new file uploaded
                    medicalCondition: document.getElementById('editMedicalCondition').value,
                    updateFiles: studentCardFile || photoFile // Flag to indicate if files were updated
                };
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('Data peserta berhasil diperbarui!', 'success');
                    closeEditModal();
                    loadParticipants(); // Reload the list
                } else {
                    showToast(result.message || 'Gagal memperbarui data peserta!', 'error');
                }
                
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
                
            } catch (error) {
                showToast(error.message || 'Terjadi kesalahan saat memperbarui data', 'error');
                const submitBtn = e.target.querySelector('button[type="submit"]');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Simpan';
            }
        }

        function closeEditModal() {
            document.getElementById('editParticipantModal').classList.add('hidden');
        }

        async function deleteParticipant(index) {
            // Get participant name for confirmation
            let participantName = 'peserta ini';
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'getParticipants',
                        username: currentUser
                    })
                });
                
                const result = await response.json();
                if (result.success && result.participants && result.participants[index]) {
                    participantName = result.participants[index].participantName;
                }
            } catch (error) {
                // Use default name if can't fetch
            }
            
            if (!confirm(`Apakah Anda yakin ingin menghapus peserta "${participantName}"?\n\nData yang dihapus tidak dapat dikembalikan!`)) {
                return;
            }
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify({
                        action: 'deleteParticipant',
                        username: currentUser,
                        participantIndex: index
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('Peserta berhasil dihapus!', 'success');
                    loadParticipants(); // Reload the list
                } else {
                    showToast(result.message || 'Gagal menghapus peserta!', 'error');
                }
            } catch (error) {
                showToast('Terjadi kesalahan saat menghapus peserta', 'error');
            }
        }

        function loadSchoolData() {
            if (schoolData.schoolName) {
                document.getElementById('schoolName').value = schoolData.schoolName || '';
                document.getElementById('sanggarName').value = schoolData.sanggarName || '';
                document.getElementById('supervisorContact').value = schoolData.supervisorContact || '';
                
                // Note: File inputs cannot be pre-filled for security reasons
                // Show message if data already exists
                if (schoolData.scriptLink) {
                    showToast('Data sekolah sudah ada. Unggah file baru untuk memperbarui.', 'info');
                }
            }
        }

        function handleLogout() {
            currentUser = null;
            schoolData = {};
            localStorage.removeItem('currentUser');
            localStorage.removeItem('userPassword'); // Hapus password saat logout
            showSection('auth');
            showToast('Berhasil logout', 'success');
        }

        function checkLoginStatus() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = savedUser;
                showSection('dashboard');
            } else {
                showSection('auth');
            }
        }

        function showToast(message, type) {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastMessage = document.getElementById('toastMessage');
            
            // Set icon and message based on type
            if (type === 'success') {
                toastIcon.textContent = '‚úÖ';
                toast.querySelector('.glass-card').classList.add('border-l-4', 'border-green-500');
            } else if (type === 'info') {
                toastIcon.textContent = '‚ÑπÔ∏è';
                toast.querySelector('.glass-card').classList.add('border-l-4', 'border-blue-500');
            } else {
                toastIcon.textContent = '‚ùå';
                toast.querySelector('.glass-card').classList.add('border-l-4', 'border-red-500');
            }
            
            toastMessage.textContent = message;
            
            // Show toast
            toast.classList.remove('translate-x-full');
            toast.classList.add('translate-x-0');
            
            // Hide toast after 4 seconds
            setTimeout(() => {
                toast.classList.remove('translate-x-0');
                toast.classList.add('translate-x-full');
                
                // Clean up classes
                setTimeout(() => {
                    toast.querySelector('.glass-card').classList.remove('border-l-4', 'border-green-500', 'border-red-500', 'border-blue-500');
                }, 300);
            }, 4000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9774c45a96c7d899',t:'MTc1NjU2MTkzMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
